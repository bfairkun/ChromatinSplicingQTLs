---
title: "Check robustness of colocalization results at various thresholds"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

In a [previous notebook](20211217_GenewiseColocFirstLook.html) I explored the genewise hyprcoloc output, and noted that 30min and 60min 4sU colocalize (with all default parameters/thresholds) 80% of the time that they are tested. I expect this to be closer to 100%, and we should get similarly high colocalization with eQTL from polyA RNA-seq. Perhaps just by filtering for colocalizations above some threshold we can get more believable results. I could/should technically re-run hyprcoloc with different parameters, but before I do that, to understand the results better, let's see how these colocalization rates change after filter for different posterior probabilities for colocalization.

## Analysis

```{r}
library(tidyverse)
library(viridis)
library(gplots)
library(data.table)

dat <- read_tsv("../output/hyprcoloc_results/ForColoc/MolColocStandard/hyprcoloc.results.txt.gz", col_names = c("Locus", "iteration", 'ColocalizedTraits', 'ColocPr', 'RegionalPr', "topSNP", "TopSNPFinemapPr", "DroppedTrait"), skip=1)

dat$ColocPr %>% hist()
```

The default posterior probability for colocalization clustering is 0.25 (and the authors don't recommend going below this)... Above I plotted histogram of posterior probabilties for colocalized clusters.

```{r}
dat %>%
  # head(1000) %>%
  separate_rows(ColocalizedTraits, sep = ', ') %>%
  mutate(Trait = case_when(
    ColocalizedTraits == "None" ~ DroppedTrait,
    TRUE ~ ColocalizedTraits
  )) %>%
  select(-ColocalizedTraits, -DroppedTrait) %>%
  left_join(., ., by = "Locus") %>% 
    filter(Trait.x != Trait.y) %>% 
    rowwise() %>%
    mutate(name = toString(sort(c(Trait.x,Trait.y)) )) %>% 
    distinct(Locus, name, .keep_all = T) %>% 
    separate(name, into = c("PC1","P1","DummySpace","PC2","P2"), sep = "[, ;]") %>% 
    select(-DummySpace) %>%
    mutate(PC_ClassPair = paste(PC1, PC2)) %>%
    # pull(PC_ClassPair) %>% unique()
    mutate(IsColocalizedPair = iteration.x == iteration.y)

```


